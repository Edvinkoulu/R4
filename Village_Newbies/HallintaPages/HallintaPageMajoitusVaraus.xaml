<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Village_Newbies.ViewModels"
             x:Class="Village_Newbies.HallintaPages.HallintaPageMajoitusVaraus"
             Title="Majoitusvaraukset"
             BackgroundColor="{DynamicResource PageBackgroundColor}">

    <ContentPage.BindingContext>
        <vm:MajoitusVarausViewModel />
    </ContentPage.BindingContext>

    <ScrollView Padding="20">
        <StackLayout Spacing="15">

            <Label Text="Majoitusvarausten hallinta" FontSize="24" HorizontalOptions="Center"/>

            <!-- Varauslomake -->
            <Label Text="Tee varaus:" FontAttributes="Bold"/>
            <Frame Padding="10" BorderColor="Gray">
                <StackLayout Spacing="8">
                    <Label Text="Valitse asiakas:"/>
                    <Picker ItemsSource="{Binding Asiakkaat}"
                            SelectedItem="{Binding ValittuAsiakas}"
                            ItemDisplayBinding="{Binding kokoNimi}"/>

                    <Label Text="Valitse mökki:"/>
                    <Picker ItemsSource="{Binding Mokit}"
                            SelectedItem="{Binding ValittuMokki}"
                            ItemDisplayBinding="{Binding Mokkinimi}"/>

                    <Label Text="Alkupäivä:"/>
                    <DatePicker Date="{Binding ValittuVaraus.varattu_alkupvm, Mode=TwoWay}"/>

                    <Label Text="Loppupäivä:"/>
                    <DatePicker Date="{Binding ValittuVaraus.varattu_loppupvm, Mode=TwoWay}"/>

                    <Button Text="Tallenna varaus" Command="{Binding LisaaVarausCommand}" BackgroundColor="DarkGreen" TextColor="White"/>
                </StackLayout>
            </Frame>

            <!-- Varauslista -->
            <Label Text="Varaukset:" FontAttributes="Bold"/>
            <CollectionView ItemsSource="{Binding Varaukset}" SelectedItem="{Binding ValittuVaraus}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10" BorderColor="Gray">
                            <StackLayout Spacing="4">
                                <Label Text="{Binding varaus_id, StringFormat='ID: {0}'}"/>
                                <Label Text="{Binding asiakas_id, StringFormat='Asiakas ID: {0}'}"/>
                                <Label Text="{Binding mokki_id, StringFormat='Mökki ID: {0}'}"/>
                                <Label Text="{Binding varattu_pvm, StringFormat='Varattu: {0:dd.MM.yyyy}'}"/>
                                <Label Text="{Binding varattu_alkupvm, StringFormat='Alku: {0:dd.MM.yyyy}'}"/>
                                <Label Text="{Binding varattu_loppupvm, StringFormat='Loppu: {0:dd.MM.yyyy}'}"/>
                                <HorizontalStackLayout Spacing="8">
                                    <Button Text="Poista" Command="{Binding BindingContext.PoistaVarausCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}" WidthRequest="100"/>
                                    <Button Text="Muokkaa" Command="{Binding BindingContext.MuokkaaVarausCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}" WidthRequest="100"/>
                                </HorizontalStackLayout>
                            </StackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <Button Text="Lisää uusi varaus" Command="{Binding LisaaVarausCommand}" BackgroundColor="LightGreen" WidthRequest="170"/>
        </StackLayout>
    </ScrollView>
</ContentPage>
